{"version":3,"file":"shady-render-apply_test.js","sourceRoot":"","sources":["../../../src/test/lib/shady-render-apply_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n// Rename the html tag so that CSS linting doesn't warn on the non-standard\n// @apply syntax\nimport {html as htmlWithApply} from '../../lib/shady-render.js';\nimport {policy} from '../test-utils/security.js';\nimport {renderShadowRoot} from '../test-utils/shadow-root.js';\n\nconst assert = chai.assert;\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nconst testIfUsingNativeCSSVariables = (test: any) =>\n    (window.ShadyCSS && !window.ShadyCSS.nativeCss ? test.skip : test);\n\nsuite('shady-render @apply', () => {\n  test('styles with css custom properties using @apply render', function() {\n    const container = document.createElement('scope-5');\n    document.body.appendChild(container);\n    const result = htmlWithApply`\n      <style>\n        :host {\n          --batch: {\n            border: 3px solid orange;\n            padding: 4px;\n          };\n        }\n        div {\n          @apply --batch;\n        }\n      </style>\n      <div>Testing...</div>\n    `;\n    renderShadowRoot(result, container);\n    const div = (container.shadowRoot!).querySelector('div');\n    const computedStyle = getComputedStyle(div!);\n    assert.equal(\n        computedStyle.getPropertyValue('border-top-width').trim(), '3px');\n    assert.equal(computedStyle.getPropertyValue('padding-top').trim(), '4px');\n    document.body.removeChild(container);\n  });\n\n  test('styles with mixins that are not in a TemplateInstance', function() {\n    const container = document.createElement('scope-6');\n    document.body.appendChild(container);\n    const style = document.createElement('style');\n    style.innerHTML = policy.createHTML(`\n      :host {\n        --batch: {\n          border: 3px solid orange;\n          padding: 4px;\n        };\n      }\n      div {\n        @apply --batch;\n      }\n    `);\n    const result = [style, htmlWithApply`<div>Testing...</div>`];\n    renderShadowRoot(result, container);\n    const div = (container.shadowRoot!).querySelector('div');\n    const computedStyle = getComputedStyle(div!);\n    assert.equal(\n        computedStyle.getPropertyValue('border-top-width').trim(), '3px');\n    assert.equal(computedStyle.getPropertyValue('padding-top').trim(), '4px');\n    document.body.removeChild(container);\n  });\n\n  test(\n      'styles with css custom properties using @apply render in different contexts',\n      async () => {\n        const applyUserContent = htmlWithApply`\n        <style>\n          div {\n            border-top: 2px solid black;\n            margin-top: 4px;\n            @apply --stuff;\n          }\n        </style>\n        <div>Testing...</div>\n      `;\n\n        // Test an apply user and multiple times to see that multiple stampings\n        // work.\n        const testApplyUser = () => {\n          const applyUser = document.createElement('apply-user');\n          document.body.appendChild(applyUser);\n          renderShadowRoot(applyUserContent, applyUser);\n          const applyUserDiv = (applyUser.shadowRoot!).querySelector('div');\n          const applyUserStyle = getComputedStyle(applyUserDiv!);\n          assert.equal(\n              applyUserStyle.getPropertyValue('border-top-width').trim(),\n              '2px');\n          assert.equal(\n              applyUserStyle.getPropertyValue('margin-top').trim(), '4px');\n          document.body.removeChild(applyUser);\n        };\n        testApplyUser();\n        testApplyUser();\n\n        // Test an apply user inside a producer and do it multiple times to see\n        // that multiple stampings work.\n        const testApplyProducer = () => {\n          const producerContent = htmlWithApply`\n      <style>\n        :host {\n          --stuff: {\n            border-top: 10px solid orange;\n            padding-top: 20px;\n          };\n        }\n      </style>\n      <apply-user></apply-user>\n      <apply-user></apply-user>\n    `;\n          const applyProducer = document.createElement('apply-producer');\n          document.body.appendChild(applyProducer);\n          renderShadowRoot(producerContent, applyProducer);\n          const usersInProducer =\n              applyProducer.shadowRoot!.querySelectorAll('apply-user');\n          renderShadowRoot(applyUserContent, usersInProducer[0]);\n          renderShadowRoot(applyUserContent, usersInProducer[1]);\n          const userInProducerStyle1 = getComputedStyle(\n              usersInProducer[0].shadowRoot!.querySelector('div')!);\n          const userInProducerStyle2 = getComputedStyle(\n              usersInProducer[1].shadowRoot!.querySelector('div')!);\n          assert.equal(\n              userInProducerStyle1.getPropertyValue('border-top-width').trim(),\n              '10px');\n          assert.equal(\n              userInProducerStyle1.getPropertyValue('padding-top').trim(),\n              '20px');\n          assert.equal(\n              userInProducerStyle2.getPropertyValue('border-top-width').trim(),\n              '10px');\n          assert.equal(\n              userInProducerStyle2.getPropertyValue('padding-top').trim(),\n              '20px');\n          document.body.removeChild(applyProducer);\n        };\n\n        // test multiple times to make sure there's no bad interaction\n        testApplyProducer();\n        testApplyUser();\n        testApplyProducer();\n      });\n\n  // TODO(sorvell): remove skip when this ShadyCSS PR is merged:\n  // https://github.com/webcomponents/shadycss/pull/227.\n  testIfUsingNativeCSSVariables(test)(\n      '@apply styles flow to custom elements that render in connectedCallback',\n      () => {\n        class E extends HTMLElement {\n          connectedCallback() {\n            const result = htmlWithApply`<style>\n              div {\n                border-top: 6px solid black;\n                margin-top: 8px;\n                @apply --stuff-ce;\n              }\n            </style>\n            <div>Testing...</div>`;\n            renderShadowRoot(result, this);\n          }\n        }\n        customElements.define('apply-user-ce1', E);\n        customElements.define('apply-user-ce2', class extends E {});\n\n        const producerContent = htmlWithApply`\n          <style>\n            apply-user-ce1 {\n              --stuff-ce: {\n                border-top: 10px solid orange;\n                padding-top: 20px;\n              };\n            }\n\n            apply-user-ce2 {\n              --stuff-ce: {\n                border-top: 5px solid orange;\n                padding-top: 10px;\n              };\n            }\n          </style>\n          <apply-user-ce1></apply-user-ce1>\n          <apply-user-ce2></apply-user-ce2>\n        `;\n        const applyProducer = document.createElement('apply-producer-ce');\n        document.body.appendChild(applyProducer);\n        renderShadowRoot(producerContent, applyProducer);\n        const user1 =\n            applyProducer.shadowRoot!.querySelector('apply-user-ce1')!;\n        const userInProducerStyle1 =\n            getComputedStyle(user1.shadowRoot!.querySelector('div')!);\n        const user2 =\n            applyProducer.shadowRoot!.querySelector('apply-user-ce2')!;\n        const userInProducerStyle2 =\n            getComputedStyle(user2.shadowRoot!.querySelector('div')!);\n        assert.equal(\n            userInProducerStyle1.getPropertyValue('border-top-width').trim(),\n            '10px');\n        assert.equal(\n            userInProducerStyle1.getPropertyValue('padding-top').trim(),\n            '20px');\n        assert.equal(\n            userInProducerStyle2.getPropertyValue('border-top-width').trim(),\n            '5px');\n        assert.equal(\n            userInProducerStyle2.getPropertyValue('padding-top').trim(),\n            '10px');\n        document.body.removeChild(applyProducer);\n      });\n});\n"]}